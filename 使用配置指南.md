# TrendRadar 使用、配置、编辑、更新完整指南

> 🎯 一站式指南：快速开始 → 配置管理 → 日常维护 → 故障排除

---

## 📚 目录

1. [快速开始](#快速开始)
2. [项目结构](#项目结构)
3. [配置管理](#配置管理)
4. [编辑和更新](#编辑和更新)
5. [GitHub Actions 自动化](#github-actions-自动化)
6. [常见问题](#常见问题)
7. [故障排除](#故障排除)

---

## 快速开始

### 🚀 5 分钟快速启动

**前提条件：**
- 已 fork 本项目到你的 GitHub 账户
- Python 3.9+ 和 pip 已安装
- 飞书、企业微信等推送工具（可选）

**步骤 1：克隆项目**
```bash
git clone https://github.com/你的用户名/TrendRadar.git
cd TrendRadar
```

**步骤 2：安装依赖**
```bash
pip install -r requirements.txt
```

**步骤 3：配置推送（可选）**
- 编辑 `config/config.yaml` - 填入飞书/企业微信 webhook
- 编辑 `config/frequency_words.txt` - 添加关心的关键词

**步骤 4：本地测试**
```bash
python main.py
```

**步骤 5：上传到 GitHub**
```bash
git add config/
git commit -m "初始配置"
git push
```

**完成！** GitHub Actions 会每小时自动运行 ✅

---

## 项目结构

```
TrendRadar/
├── main.py                          # 核心爬虫程序
├── config/
│   ├── config.yaml                 # 🔧 主配置文件
│   └── frequency_words.txt         # 🔧 关键词配置
├── output/
│   └── 2025年10月18日/
│       ├── html/                   # 网页版报告
│       └── txt/                    # 文本版报告
├── .github/
│   └── workflows/
│       └── crawler.yml             # GitHub Actions 工作流
├── requirements.txt                # 依赖列表
├── index.html                      # GitHub Pages 模板
└── README.md                        # 项目说明

🔧 = 用户需要编辑的文件
```

---

## 配置管理

### 📋 config.yaml 完整说明

#### 1️⃣ 应用设置
```yaml
app:
  version_check_url: "检查更新的地址"
  show_version_update: true  # 是否显示版本更新提示
```

#### 2️⃣ 爬虫设置
```yaml
crawler:
  request_interval: 1000        # 请求间隔（毫秒）
  enable_crawler: true          # 是否启用爬虫
  use_proxy: false              # 是否使用代理
  default_proxy: "http://127.0.0.1:10086"  # 代理地址
```

#### 3️⃣ 推送模式选择 ⭐
```yaml
report:
  mode: "current"  # 三选一：
                   # - daily: 每小时推送当日所有匹配新闻
                   # - current: 每小时推送当前榜单匹配新闻
                   # - incremental: 有新增才推送
  rank_threshold: 5  # 排名高亮阈值
```

**三种模式对比：**

| 模式 | 推送时机 | 显示内容 | 适用场景 |
|------|--------|--------|--------|
| `daily` | 每小时 | 当日所有匹配新闻 | 日报总结、全面了解 |
| `current` | 每小时 | 当前榜单匹配新闻 | 实时热点追踪 |
| `incremental` | 有新增 | 新出现的匹配新闻 | 高频监控、避免重复 |

#### 4️⃣ 通知设置 ⭐
```yaml
notification:
  enable_notification: true      # 是否启用通知
  message_batch_size: 4000       # 消息分批大小（字节）
  batch_send_interval: 1         # 批次发送间隔（秒）

  # 🕐 推送时间窗口（可选功能）
  push_window:
    enabled: false               # 是否启用时间窗口
    time_range:
      start: "20:00"            # 推送开始时间（北京时间）
      end: "22:00"              # 推送结束时间
    once_per_day: true          # 窗口内每天只推送一次
```

#### 5️⃣ Webhook 配置 ⭐
```yaml
webhooks:
  feishu_url: ""                # 飞书 webhook
  wework_url: ""                # 企业微信 webhook
  dingtalk_url: ""              # 钉钉 webhook
  telegram_bot_token: ""        # Telegram token
  telegram_chat_id: ""          # Telegram chat ID
  email_from: ""                # 发件邮箱
  email_password: ""            # 邮箱密码/授权码
  email_to: ""                  # 收件邮箱
```

**⚠️ 安全提示：**
- 如果在 GitHub 上 fork，**不要在此填写任何 webhooks**
- 改用 GitHub Secrets（Settings → Secrets → Actions）
- 本地开发可在此填写，但 push 前删除

#### 6️⃣ 权重设置
```yaml
weight:
  rank_weight: 0.6       # 排名权重（60%）- 看重排名高的新闻
  frequency_weight: 0.3  # 频次权重（30%）- 看重重复出现的话题
  hotness_weight: 0.1    # 热度权重（10%）- 看重排名质量
```

#### 7️⃣ 监控平台
```yaml
platforms:
  - id: "toutiao"          # 平台 ID（不要改）
    name: "今日头条"        # 显示名称（可自定义）
  - id: "baidu"
    name: "百度热搜"
  # ... 其他 11 个平台
```

---

### 📝 frequency_words.txt 关键词配置

#### 基础语法

**普通关键词**（包含即可推送）：
```
AI
机器人
```

**必须词** `+`（包含该词才推送）：
```
+华为
+鸿蒙
```

**过滤词** `!`（不推送包含该词的新闻）：
```
!广告
!娱乐
```

#### 词组管理

用**空行**分组，独立统计：
```
# 第 1 组：科技公司
华为
鸿蒙

# 第 2 组：AI 大模型
DeepSeek
Claude
ChatGPT

# 第 3 组：动画/漫展
漫展
动漫
新番

# 第 4 组：流体力学
CFD
计算流体力学
流体力学
```

**输出效果：**
```
🔥 [1/3] 华为 鸿蒙 : 5 条
🔥 [2/3] DeepSeek Claude ChatGPT : 3 条
🔥 [3/3] 漫展 动漫 新番 : 2 条
```

#### 示例配置

```
# 最受欢迎的公司
胖东来
华为
比亚迪
大疆

# AI 相关
AI
人工智能
ChatGPT
Claude

# 我的兴趣
漫展
动漫
新番

# 技术方向
CFD
计算流体力学
数码
手机

# 排除词
!广告
!娱乐
!八卦
```

---

## 编辑和更新

### 📝 本地编辑流程

#### 修改 1：更新关键词

**场景：** 想添加"王思聪"和"房产"关键词

**步骤：**
```bash
# 1. 编辑文件（用记事本或任何编辑器打开）
# D:\ai\TrendRadar\config\frequency_words.txt
# 在文件末尾添加：
# 王思聪
# 房产

# 2. 保存文件，返回终端

# 3. 同步到 GitHub
cd D:/ai/TrendRadar
git add config/frequency_words.txt
git commit -m "添加关键词：王思聪、房产"
git push
```

**完成！** 下一个整点时刻自动生效 ✅

---

#### 修改 2：切换推送模式

**场景：** 从 `current` 改为 `daily`

**步骤：**
```bash
# 1. 编辑 config.yaml
# 找到这一行：
#   mode: "current"
# 改为：
#   mode: "daily"

# 2. 保存文件

# 3. 同步到 GitHub
cd D:/ai/TrendRadar
git add config/config.yaml
git commit -m "改为daily模式"
git push
```

---

#### 修改 3：启用推送时间窗口

**场景：** 只想在晚上 20:00-22:00 收到推送

**编辑 config.yaml：**
```yaml
push_window:
  enabled: true                 # 改为 true
  time_range:
    start: "20:00"             # 开始时间
    end: "22:00"               # 结束时间
  once_per_day: true           # 每天只推送一次
```

**同步：**
```bash
git add config/config.yaml
git commit -m "启用推送时间窗口 20:00-22:00"
git push
```

---

### 🔄 修改-测试-上传完整流程

假设你要修改多个配置：

```bash
# 1. 在本地编辑器中修改文件
#    - 编辑 config/frequency_words.txt
#    - 编辑 config/config.yaml

# 2. 本地测试（可选）
python main.py

# 3. 查看修改
git status

# 4. 添加修改
git add config/

# 5. 提交修改（带清晰的说明）
git commit -m "优化配置：添加漫展相关词汇，切换为daily模式"

# 6. 推送到 GitHub
git push

# 7. 完成！自动生效
```

---

## GitHub Actions 自动化

### ⏰ 工作流说明

**运行时间：** 每小时整点（北京时间）

**工作流配置位置：** `.github/workflows/crawler.yml`

### 🚀 手动触发工作流

有时你想立即运行而不等一小时：

**步骤：**
1. 打开 https://github.com/你的用户名/TrendRadar/actions
2. 点击左侧 **Hot News Crawler**
3. 点击 **Run workflow** 按钮
4. 选择分支（通常是 `master` 或 `main`）
5. 点击绿色 **Run workflow** 按钮
6. 等待 1-2 分钟

**完成！** 查看飞书群是否收到新推送 ✅

### 📊 查看运行日志

**查看详细日志：**
1. 进入 **Actions** 页面
2. 点击最新的运行记录
3. 展开各个步骤查看日志

**常见日志信息：**
```
✅ 配置文件检查通过
✅ 成功获取 11 个平台数据
✅ 筛选出 255 条当前榜单
✅ 匹配 21 条频率词新闻
✅ HTML 报告已生成
✅ 推送到飞书成功
```

### 🔧 GitHub Secrets 配置

如果需要修改飞书 webhook：

**步骤：**
1. Settings → Secrets and variables → Actions
2. 点击 **FEISHU_WEBHOOK_URL**
3. 点击编辑（小铅笔图标）
4. 更新 webhook URL
5. 点击 **Update secret**

**完成！** 下一次运行自动使用新的 webhook ✅

---

## 常见问题

### Q1: 为什么没有收到某个关键词的推送？

**A:** 该关键词在当前热搜中没有出现。

- 检查热搜数据：查看 `output/` 文件夹中的 txt 文件
- 监控热度：等待该话题成为热搜
- 验证配置：确保关键词正确拼写，没有多余空格

---

### Q2: 如何修改推送频率（从每小时改成每半小时）？

**A:** 编辑 `.github/workflows/crawler.yml`

找到这一行：
```yaml
- cron: "0 * * * *"  # 每小时整点
```

改为：
```yaml
- cron: "*/30 * * * *"  # 每半小时
```

或：
```yaml
- cron: "*/30 0-14 * * *"  # 早上 8 点到晚上 10 点，每半小时
```

**注意：** 修改工作流文件需要 push 到 GitHub 才能生效

---

### Q3: 本地运行报错"'gbk' codec can't encode"怎么办？

**A:** Windows 编码问题。用以下命令运行：

```bash
python main.py 2>&1 | iconv -f GBK -t UTF-8
```

或使用 PowerShell：
```powershell
$env:PYTHONIOENCODING="utf-8"
python main.py
```

---

### Q4: 推送消息太长，被截断了怎么办？

**A:** 修改 `config.yaml`

```yaml
notification:
  message_batch_size: 8000    # 从 4000 改大
  dingtalk_batch_size: 30000  # 从 20000 改大
```

---

### Q5: 想要不同的推送渠道（邮件、Telegram 等）怎么配置？

**A:** 在 GitHub Secrets 中添加相应的 Secret

支持的推送渠道：
- `FEISHU_WEBHOOK_URL` - 飞书
- `WEWORK_WEBHOOK_URL` - 企业微信
- `DINGTALK_WEBHOOK_URL` - 钉钉
- `TELEGRAM_BOT_TOKEN` + `TELEGRAM_CHAT_ID` - Telegram
- `EMAIL_FROM` + `EMAIL_PASSWORD` + `EMAIL_TO` - 邮件

---

### Q6: 我想本地保存报告，怎么查看？

**A:** 爬虫会自动保存到 `output/` 文件夹

```
output/
└── 2025年10月18日/
    ├── html/
    │   └── 12时27分.html      # 用浏览器打开
    └── txt/
        └── 12时27分.txt        # 用文本编辑器打开
```

---

## 故障排除

### 🔧 GitHub Actions 显示失败

**检查步骤：**

1. **查看日志**
   - Actions 页面 → 点击最新运行 → 展开 "Run crawler" 步骤
   - 查看错误信息

2. **常见错误及解决方案**

| 错误信息 | 原因 | 解决方案 |
|--------|------|--------|
| `config.yaml 文件不存在` | 配置文件缺失 | 确保本地有配置文件，已 push 到 GitHub |
| `frequency_words.txt 文件不存在` | 关键词文件缺失 | 确保本地有配置文件，已 push 到 GitHub |
| `Webhook URL 无效` | Secret 配置错误 | 检查 GitHub Secrets 中的 URL 是否正确 |
| `网络请求超时` | 爬虫无法访问网站 | 正常现象，会重试；或网站暂时无法访问 |

---

### 🔍 推送没有收到

**检查清单：**

1. ✅ GitHub Secrets 已添加？
   - Settings → Secrets → FEISHU_WEBHOOK_URL

2. ✅ Webhook URL 有效？
   - 打开 URL，查看飞书群是否收到测试消息

3. ✅ 关键词在热搜中出现？
   - 查看 `output/` 文件夹中的 txt 文件，搜索关键词

4. ✅ 推送模式配置正确？
   - `config.yaml` 中 `mode` 的值是什么

5. ✅ 通知功能启用？
   - `config.yaml` 中 `enable_notification: true`

---

### 📊 想要查看历史数据

**本地查看：**
```bash
# 列出所有输出文件
ls output/*/html/
ls output/*/txt/

# 查看最新的 HTML 报告
start output/2025年10月18日/html/最新时间.html
```

**GitHub 查看：**
- 进入 GitHub 仓库
- 点击 Actions
- 查看每次运行的 Artifacts（如果配置了）

---

### 🆘 其他问题

**获取帮助：**
1. 查看项目的 GitHub Issues
2. 查看原始项目的讨论区
3. 检查 `README.md` 中的常见问题

---

## 🎯 快速参考卡

### 最常用的命令

```bash
# 查看当前改动
git status

# 同步所有改动（通用）
git add .
git commit -m "修改说明"
git push

# 只同步配置文件
git add config/
git commit -m "修改说明"
git push

# 查看推送历史
git log --oneline -10
```

### 配置文件位置

| 文件 | 路径 | 用途 |
|------|------|------|
| 配置文件 | `config/config.yaml` | 推送模式、时间窗口、webhook 等 |
| 关键词 | `config/frequency_words.txt` | 监控的关键词 |
| 工作流 | `.github/workflows/crawler.yml` | 自动化运行时间设置 |

### 修改后自动生效时间

| 修改内容 | 生效时间 |
|--------|--------|
| 关键词配置 | 下个整点时刻 |
| 推送模式 | 下个整点时刻 |
| GitHub Secrets | 下个整点时刻 |
| 工作流文件 | 下个整点时刻 |

---

## 📞 支持

- **项目主页：** https://github.com/KIYOYOZU/TrendRadar
- **原始项目：** https://github.com/sansan0/TrendRadar
- **问题反馈：** GitHub Issues

---

**祝你使用愉快！🎉**

最后更新：2025-10-18
